<!DOCTYPE html>
<html lang="ru" class="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Список покупок</title>
  <link href="https://fonts.googleapis.com/css2?family=Unbounded:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: 'Unbounded', sans-serif; }
  </style>
</head>
<body class="bg-gray-900 min-h-screen p-6 text-gray-100">
  <div class="max-w-4xl mx-auto bg-gray-800 p-6 rounded-lg shadow-md border border-gray-700">
    <h1 class="text-3xl font-bold text-center mb-6 text-gray-100">Список покупок</h1>

    <form id="addForm" class="mb-6">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <input type="text" id="name" placeholder="Название" required class="border border-gray-600 rounded-lg px-4 py-2 bg-gray-700 text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
        <input type="number" id="quantity" placeholder="Количество" required class="border border-gray-600 rounded-lg px-4 py-2 bg-gray-700 text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
        <input type="text" id="category" placeholder="Категория (автоматически)" class="border border-gray-600 rounded-lg px-4 py-2 bg-gray-700 text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
        <button type="submit" class="bg-gradient-to-r from-blue-500 to-blue-700 text-white rounded-lg px-4 py-2 shadow-lg hover:shadow-xl hover:scale-105 transition-all duration-200 font-semibold">Добавить</button>
      </div>
    </form>

    <div class="mb-4">
      <input type="text" id="search" placeholder="Поиск по названию" class="w-full border border-gray-600 rounded-lg px-4 py-2 bg-gray-700 text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
    </div>

    <div id="purchases" class="space-y-4"></div>
  </div>

  <script>
    const apiUrl = '/purchases';

    const categories = {
      'молоко': 'Молочные продукты',
      'сыр': 'Молочные продукты',
      'йогурт': 'Молочные продукты',
      'масло': 'Молочные продукты',
      'мясо': 'Мясо',
      'курица': 'Мясо',
      'рыба': 'Мясо',
      'колбаса': 'Мясо',
      'хлеб': 'Выпечка',
      'булка': 'Выпечка',
      'торт': 'Выпечка',
      'печенье': 'Выпечка',
      'яблоко': 'Фрукты',
      'банан': 'Фрукты',
      'апельсин': 'Фрукты',
      'груша': 'Фрукты',
      'морковь': 'Овощи',
      'картофель': 'Овощи',
      'лук': 'Овощи',
      'помидор': 'Овощи',
      'сок': 'Напитки',
      'вода': 'Напитки',
      'чай': 'Напитки',
      'кофе': 'Напитки'
    };

    function determineCategory(name) {
      const lowerName = name.toLowerCase();
      for (const [keyword, cat] of Object.entries(categories)) {
        if (lowerName.includes(keyword)) {
          return cat;
        }
      }
      return '';
    }

    function updateCategory() {
      const name = document.getElementById('name').value;
      const categoryField = document.getElementById('category');
      categoryField.value = determineCategory(name);
    }

    async function loadPurchases() {
      const response = await fetch(apiUrl);
      const purchases = await response.json();
      const searchTerm = document.getElementById('search').value.toLowerCase();
      const container = document.getElementById('purchases');
      container.innerHTML = '';

      const filteredPurchases = purchases.filter(p => p.name.toLowerCase().includes(searchTerm));

      filteredPurchases.forEach(purchase => {
        const div = document.createElement('div');
        div.className = `p-4 border border-gray-600 rounded-lg ${purchase.completed ? 'bg-gray-700' : 'bg-gray-800'} flex justify-between items-center`;
        div.innerHTML = `
          <div>
            <span class="font-semibold ${purchase.completed ? 'line-through text-gray-500' : 'text-gray-100'}">${purchase.name} (${purchase.quantity})</span>
            <span class="text-sm text-gray-400 ml-2">- ${purchase.category}</span>
          </div>
          <div>
            <button onclick="toggleComplete(${purchase.id})" class="bg-gradient-to-r from-green-500 to-green-700 text-white px-3 py-1 rounded hover:scale-105 shadow-md hover:shadow-lg transition-all duration-200 font-semibold mr-2">${purchase.completed ? 'Отменить' : 'Выполнить'}</button>
            <button onclick="deletePurchase(${purchase.id})" class="bg-gradient-to-r from-red-500 to-red-700 text-white px-3 py-1 rounded hover:scale-105 shadow-md hover:shadow-lg transition-all duration-200 font-semibold">Удалить</button>
          </div>
        `;
        container.appendChild(div);
      });
    }

    async function addPurchase(event) {
      event.preventDefault();
      const name = document.getElementById('name').value;
      const quantity = document.getElementById('quantity').value;
      const category = document.getElementById('category').value;

      const data = { name, quantity };
      if (category.trim()) {
        data.category = category;
      }

      await fetch(apiUrl, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });

      document.getElementById('addForm').reset();
      loadPurchases();
    }

    async function toggleComplete(id) {
      const response = await fetch(`${apiUrl}/${id}`);
      const purchase = await response.json();

      await fetch(`${apiUrl}/${id}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ completed: !purchase.completed })
      });

      loadPurchases();
    }

    async function deletePurchase(id) {
      await fetch(`${apiUrl}/${id}`, { method: 'DELETE' });
      loadPurchases();
    }

    document.getElementById('addForm').addEventListener('submit', addPurchase);
    document.getElementById('name').addEventListener('input', updateCategory);
    document.getElementById('search').addEventListener('input', loadPurchases);
    loadPurchases();
  </script>
</body>
</html>